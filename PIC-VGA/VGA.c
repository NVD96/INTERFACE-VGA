///////////////////////////////////////////////////////////////////////////
////                                                                   ////
////                             VGA.c                                 ////
////                                                                   ////
////               2 Color VGA driver for CCS C compiler               ////
////                                                                   ////
///////////////////////////////////////////////////////////////////////////
////                                                                   ////
////                    https://simple-circuit.com/                    ////
////                                                                   ////
///////////////////////////////////////////////////////////////////////////


#include <stdint.h>
#ifndef bool
  #define bool int1
#endif

#define BLACK 0
#define WHITE 1

// defined VGA height in pixel
#if !defined VGAHEIGHT_96 && !defined VGAHEIGHT_128 && !defined VGAHEIGHT_160
  #define VGAHEIGHT_64
#endif
#if defined  VGAHEIGHT_64
  #define VGAHEIGHT    64
#elif defined VGAHEIGHT_96
  #define VGAHEIGHT    96
#elif defined VGAHEIGHT_128
  #define VGAHEIGHT    128
#elif defined VGAHEIGHT_160
  #define VGAHEIGHT    160
#endif

#ifndef PACKED_LINES
  #define PACKED_LINES  3   // number of packed lines per 1 line (pixel)
#endif
#define VGAWIDTH    160     // defined VGA width in pixel
#ifndef STARTLINE
  #define STARTLINE  50     // start line
#endif
#define ENDLINE   (STARTLINE + VGAHEIGHT * PACKED_LINES)  // end line
#define VGA_BWIDTH   20   // number of bytes in a row ( = VGAWIDTH/8 )
#ifndef VSYNCPIN
  #define VSYNCPIN PIN_C0
#endif
#define HSYNCPIN PIN_C2  // HSYNC signal mapped to pin RC2 (fixed)
#define DATAPIN  PIN_D7  // video signal mapped to pin RD7 (fixed)

//*************************** User Functions ***************************//

void VGA_begin();

void drawPixel(uint8_t x, uint8_t y, bool color);
void drawLine(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, bool color);
void drawHLine(uint8_t x, uint8_t y, uint8_t w, bool color);
void drawVLine(uint8_t x, uint8_t y, uint8_t w, bool color);
void fillRect(uint8_t x, uint8_t y, uint8_t w, uint8_t h, bool color);

void setRotation(uint8_t m);
void display_clear();
void fillScreen();

/////////////////////////////////////////////////////////////////////////

#define vga_swap(a, b) { uint8_t t = a; a = b; b = t; }

#BYTE LATD  = 0xF8C
#BYTE FSR0  = 0xFE9
static uint16_t line = 0, loc = 0;
static uint8_t line_n;
uint8_t _width, _height, rotation;

// display memory buffer
// buffer image by MikroElektronika
static uint8_t vga_buffer[VGAWIDTH * VGAHEIGHT / 8] = {
0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x0A, 0x81, 0xBF, 0xF7, 0x21, 0xE8, 0x00, 0x00, 
0x00, 0x00, 0x07, 0xC0, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x3E, 0x06, 0xDF, 0xFF, 0x3E, 0x98, 0x00, 0x00, 
0x00, 0x00, 0x09, 0x00, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0xCA, 0x06, 0x7B, 0x7B, 0xFF, 0xB4, 0x00, 0x00, 
0x00, 0x00, 0x07, 0x80, 0xF3, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x01, 0xC7, 0xF0, 0x01, 0xFC, 0xFF, 0xE1, 0xB4, 0x00, 0x00, 
0x00, 0x00, 0x03, 0xFF, 0xCE, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x30, 0x71, 0x07, 0x8F, 0x1D, 0xE0, 0x00, 0x00, 
0x00, 0x00, 0x03, 0x81, 0xFF, 0xF2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xBE, 0x00, 0x0E, 0x1F, 0xF0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xFE, 0x0F, 0xBA, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x08, 0x70, 0x00, 0x00, 0x9E, 0x9C, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7E, 0xBE, 0xC4, 0x00, 0x00, 0x00, 0x00, 0xF7, 0xEC, 0x86, 0xDF, 0xF0, 0x1F, 0xFF, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x1E, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x03, 0x93, 0x06, 0x6C, 0x46, 0xF8, 0x37, 0xBE, 0x70, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x74, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x06, 0x31, 0x01, 0xF8, 0x3C, 0x7F, 0x1C, 0x7F, 0xE8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xE6, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x1F, 0x01, 0xF4, 0x00, 0x1C, 0x85, 0xFF, 0xD0, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x08, 0xE6, 0x00, 0x1B, 0xC0, 0x77, 0xF0, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x1F, 0xF6, 0x00, 0x18, 0xE0, 0x3F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x3F, 0x02, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x0B, 0xCF, 0x00, 0x1F, 0xE0, 0x7F, 0xF0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x73, 0x0F, 0xC0, 0x00, 0x00, 0x00, 0x06, 0x70, 0x1F, 0x8F, 0xFC, 0x07, 0x7C, 0x3F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x40, 0x07, 0xC0, 0x00, 0x00, 0x00, 0x00, 0xDF, 0x20, 0x0F, 0xFE, 0x7F, 0xF3, 0xFF, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x01, 0x78, 0x3F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xE0, 0x0F, 0xFE, 0x6F, 0xDF, 0xBF, 0xFE, 0x00, 0x00, 
0x00, 0x00, 0x01, 0x9B, 0x6D, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x01, 0x8F, 0xFF, 0x7F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x07, 0xBF, 0xCD, 0xB8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x1F, 0xDF, 0xEF, 0xFE, 0x00, 0x00, 
0x00, 0x00, 0x04, 0x9D, 0x93, 0x3F, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x7F, 0xF3, 0x3F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x07, 0xEF, 0xAF, 0xFF, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE7, 0x7F, 0xED, 0xD8, 0x00, 0x00, 
0x00, 0x00, 0x0F, 0xFF, 0xF9, 0xCF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0xFF, 0x83, 0xDE, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xF9, 0xF9, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xCE, 0x00, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0xFF, 0xF9, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0xFF, 0xE0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFC, 0xF7, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xF8, 0x1F, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xF8, 0x01, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xF8, 0x30, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x03, 0xF8, 0xF8, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xF9, 0xCC, 0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0xCC, 0x04, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x07, 0xFE, 0x0C, 0x0C, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x0C, 0x7F, 0x07, 0x1C, 0xFF, 0x1F, 0xE2, 0x1F, 0xFF, 0xFF, 0x1F, 0xFC, 0x7F, 0xFF, 0xEF, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x06, 0x7E, 0x01, 0x3C, 0x81, 0x10, 0x62, 0x1C, 0x08, 0x0E, 0x10, 0x04, 0x78, 0x60, 0xED, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x02, 0x79, 0xFF, 0x3C, 0xFF, 0x1F, 0xE3, 0x9C, 0x08, 0x0E, 0x17, 0x04, 0x78, 0x60, 0xED, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x06, 0x79, 0xEF, 0xBC, 0x00, 0x00, 0x03, 0x1C, 0x08, 0x0F, 0x17, 0x04, 0x78, 0x60, 0xED, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xFF, 0x7E, 0x26, 0x00, 0x00, 0x03, 0x9F, 0xFF, 0xFF, 0x17, 0xF4, 0x7F, 0xFF, 0xFC, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x78, 0x7E, 0x26, 0x00, 0x00, 0x03, 0xFC, 0x08, 0x0E, 0x10, 0xF4, 0x78, 0x60, 0xFF, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7E, 0x31, 0xB9, 0x00, 0x00, 0x07, 0xFC, 0x08, 0x0E, 0x1C, 0x04, 0x78, 0x60, 0xF7, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7F, 0xA1, 0xFE, 0x00, 0x00, 0x07, 0xFC, 0x1F, 0xFF, 0x14, 0x04, 0x78, 0x60, 0xF2, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7D, 0x80, 0xF9, 0x00, 0x00, 0x07, 0xC0, 0x00, 0x00, 0x10, 0x04, 0x00, 0x00, 0x30, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7C, 0xC0, 0x99, 0x00, 0x00, 0x0F, 0xE0, 0x02, 0x00, 0x10, 0x04, 0x00, 0x00, 0x33, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7C, 0xFF, 0xFF, 0x80, 0x00, 0x0D, 0xF9, 0xFA, 0xF3, 0xF0, 0x07, 0x7F, 0x34, 0xFF, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x7C, 0x01, 0xC1, 0x00, 0x00, 0x0C, 0xE0, 0xF1, 0xDC, 0x3C, 0x77, 0x9C, 0xF7, 0x78, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xFE, 0x00, 0xC3, 0xFF, 0xFF, 0xFF, 0xE4, 0xF0, 0x5C, 0x30, 0x1C, 0x3C, 0x7F, 0x7C, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xBF, 0x80, 0x1F, 0x00, 0x00, 0x00, 0x37, 0xFF, 0x77, 0xFF, 0xFC, 0x78, 0x77, 0x5F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x07, 0x6F, 0xE0, 0x03, 0xE0, 0x00, 0x00, 0x04, 0x00, 0x00, 0xC0, 0x19, 0xFA, 0xCE, 0x00, 0x7C, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x04, 0x00, 0x03, 0x80, 0x30, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x01, 0xE0, 0xF8, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x64, 0x00, 0x01, 0x80, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00, 0x00, 0xB0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x07, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x98, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x03, 0xF8, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xC0, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFC, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x00, 0x3F, 0xF0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x01, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x80, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xE0, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x03, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0F, 0xFF, 0x80, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x01, 0xBF, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#if !defined VGAHEIGHT_64
,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#if !defined VGAHEIGHT_96
,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#if !defined VGAHEIGHT_128
,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#endif #endif #endif
};

void VGA_begin() {
  output_drive(VSYNCPIN);   // configure VSYNCPIN as output
  output_drive(HSYNCPIN);   // configure HSYNCPIN as output
  output_drive(DATAPIN);    // configure DATAPIN as output

  // CCP1 configuration (HSYNC pulses generator), with MCU freq = 64MHz (16 MIPS)
  // Timer2 prescaler = 1:4, postoscaler = 1:1, PR2 = 126
  // ==> period = 31.75us and freq = 31.496kHz
  // ==> max PWM duty cycle = 507 (resolution = 8.988)
  setup_timer_2(T2_DIV_BY_4, 126, 1);
  SETUP_CCP1(CCP_PWM);  // configure CCP1 module as PWM
  // set PWM1 duty cycle ( ==> ON time = 27.992us, OFF time = 3.757us)
  set_pwm1_duty(447);
  enable_interrupts(GLOBAL);      // enable global interrupts
  // enable Timer2 interrupt (interrupt on TMR2 match with PR2 ==> every 31.75us)
  enable_interrupts(INT_TIMER2);

  rotation = 0;
  _width  = VGAWIDTH;
  _height = VGAHEIGHT;
}

// the most basic function, set a single pixel
void drawPixel(uint8_t x, uint8_t y, bool color) {

  if ( (x >= _width) || (y >= _height) )
    return;

  switch(rotation) {
    case 1:
      vga_swap(x, y);
      y =  VGAHEIGHT - 1 - y;
      break;
    case 2:
      x = VGAWIDTH - 1 - x;
      y = VGAHEIGHT - 1 - y;
      break;
    case 3:
      vga_swap(x, y);
      x = VGAWIDTH - 1 - x;
  }

  if ( (x >= VGAWIDTH) || (y >= VGAHEIGHT) )
    return;

  if (color)
    vga_buffer[(uint16_t)y * 20 + (x/8)] |=  ( 1 << (7-(x & 7)) );  // set pixel

  else
    vga_buffer[(uint16_t)y * 20 + (x/8)] &= ~( 1 << (7-(x & 7)) );  // clear pixel
}

void drawLine(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, bool color) {

  bool steep = abs( (int16_t)(y1 - y0) ) > abs( (int16_t)(x1 - x0) );
  int8_t ystep;
  uint8_t dx, dy;
  int16_t err;

  if (steep) {
    vga_swap(x0, y0);
    vga_swap(x1, y1);
  }
  if (x0 > x1) {
    vga_swap(x0, x1);
    vga_swap(y0, y1);
  }
  dx = x1 - x0;
  dy = abs( (int16_t)(y1 - y0) );

  err = dx / 2;
  if (y0 < y1)
    ystep = 1;
  else
    ystep = -1;

  for (; x0 <= x1; x0++) {
    if (steep)
      drawPixel(y0, x0, color);
    else
      drawPixel(x0, y0, color);
    err -= dy;
    if (err < 0) {
      y0  += ystep;
      err += dx;
    }
  }
}

#INT_TIMER2
void isr(void) {
  line++;
  if(line > 522) {
  // generate the VCSYNC pulse
    output_low(VSYNCPIN);
    if(line > 524) {
      output_high(VSYNCPIN);
      line = 0;
      line_n = 0;
      loc = vga_buffer;  // get vga_buffer array location in RAM
    }
    return;
  }

  if (line < STARTLINE)
    return;

  //if (line > ENDLINE - 1)  return;
  #asm
  #if (ENDLINE > 256)
  MOVF   line+1, W
  SUBLW  0x00
  BC    jmp1
  XORLW  0xFF
  #else
  MOVF   line+1, F
  #endif
  BNZ   skp
  MOVF   line, W
  SUBLW  ENDLINE-1
  BC    jmp2
  #endasm
  skp: return;

  jmp1:
  #asm
  nop
  #endasm

  jmp2:
  FSR0 = loc;   // load FSR0 with data address

  #asm
  // Byte 1
  MOVF   0xFEE, 0      // 0xFEE: POSTINC0 register
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 2
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 3
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 4
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 5
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 6
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 7
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 8
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 9
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 10
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 11
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 12
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 13
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 14
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 15
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 16
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 17
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 18
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 19
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F
  // Byte 20
  MOVF   0xFEE, 0
  MOVWF  LATD     nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  RLCF   LATD, F  nop
  // return to black
  CLRF   LATD
  #endasm

  line_n++;
  if( line_n == PACKED_LINES ) {
    loc = FSR0;
    line_n = 0;
  }

}

void drawHLine(uint8_t x, uint8_t y, uint8_t w, bool color) {
   drawLine(x, y, x + w - 1, y, color);
}

void drawVLine(uint8_t x, uint8_t y, uint8_t h, bool color) {
  drawLine(x, y, x, y + h - 1, color);
}

void fillRect(uint8_t x, uint8_t y, uint8_t w, uint8_t h, bool color) {
  for (uint16_t i = x; i < x + w; i++)
    drawVLine(i, y, h, color);
}

void display_clear(void) {
  for (uint16_t i = 0; i < VGAWIDTH * VGAHEIGHT / 8; i++)
    vga_buffer[i] = 0;
}

void fillScreen() {
  for (uint16_t i = 0; i < VGAWIDTH * VGAHEIGHT / 8; i++)
    vga_buffer[i] = 0xFF;
}

// set rotation setting for display
// 0 thru 3 corresponding to 4 cardinal rotations
void setRotation(uint8_t m) {
  rotation = (m & 3);

  switch(rotation) {
    case 0:
    case 2:
      _width  = VGAWIDTH;
      _height = VGAHEIGHT;
    break;
    case 1:
    case 3:
      _width  = VGAHEIGHT;
      _height = VGAWIDTH;
      break;
  }
}

// end of library code.
